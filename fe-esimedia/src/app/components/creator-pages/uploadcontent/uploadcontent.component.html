<div class="uploadContent-container">
  <mat-card class="uploadContent-card">
    <mat-card-content>
      <mat-tab-group>
        <!-- TAB AUDIO -->
        <mat-tab label="Audio">
          <form [formGroup]="audioForm" (ngSubmit)="submitAudioForm()">
            <div class="form-container">
              <!-- Título -->
               <label for="title">Título *</label>
              <mat-form-field>
                <mat-label>Título</mat-label>
                <input matInput formControlName="title" maxlength="100" />
                <mat-error *ngIf="audioForm.get('title')?.hasError('required')">El título es obligatorio</mat-error>
                <mat-error *ngIf="audioForm.get('title')?.hasError('maxlength')">Máximo 100 caracteres</mat-error>
                <mat-hint align="end">{{ audioForm.get('title')?.value?.length || 0 }}/100</mat-hint>
              </mat-form-field>

              <!-- Descripción -->
                <label for="description">Descripción</label>
              <mat-form-field >
                <mat-label>Descripción</mat-label>
                <textarea matInput formControlName="description" maxlength="500" rows="4"></textarea>
                <mat-error *ngIf="audioForm.get('description')?.hasError('maxlength')">Máximo 500 caracteres</mat-error>
                <mat-hint align="end">{{ audioForm.get('description')?.value?.length || 0 }}/500</mat-hint>
              </mat-form-field>

              <!-- Fichero de audio -->
              <div class="file-input-group">
                <label for="audio-file">Fichero de audios * (máx 1MB)</label>
                <input #audioFileInput type="file" id="audio-file" accept="audio/*"
                  (change)="onAudioFileSelected($event)"
                  style="display: none"/>
                <button mat-raised-button color="primary" type="button"
                  (click)="audioFileInput.click()">Seleccionar archivo</button>
                <span *ngIf="audioFileName" class="file-name">{{ audioFileName }}</span>
              </div>

              <!-- Tags -->
              <label for="tags">Tags *</label>
              <mat-form-field >
                <mat-label>Tags</mat-label>
                <mat-select formControlName="tags" multiple>
                  <mat-option *ngFor="let tag of tags" [value]="tag">{{ tag }}</mat-option>
                </mat-select>
                <mat-error *ngIf="audioForm.get('tags')?.hasError('required')">Selecciona al menos un tag</mat-error>
                <mat-error *ngIf="audioForm.get('tags')?.hasError('minTags')">Mínimo 1 tag requerido</mat-error>
              </mat-form-field>

              <!-- Duración -->
              <fieldset formGroupName="duration" class="duration-group">
                <legend>Duración *</legend>
                <div class="duration-inputs">
                  <mat-form-field >
                    <mat-label>Horas</mat-label>
                    <input matInput formControlName="hours" type="number" min="0" max="23 " />
                  </mat-form-field>

                  <mat-form-field >
                    <mat-label>Minutos</mat-label>
                    <input matInput formControlName="minutes" type="number" min="0" max="59"/>
                  </mat-form-field>

                  <mat-form-field >
                    <mat-label>Segundos</mat-label>
                    <input matInput formControlName="seconds" type="number" min="0" max="59" />
                  </mat-form-field>
                </div>
                <div class="error-container" *ngIf="audioForm.get('duration')?.invalid && (audioForm.get('duration')?.touched || audioForm.get('duration')?.dirty)">
                  <mat-error *ngIf="audioForm.get('duration')?.hasError('required')">La duración es obligatoria</mat-error>
                  <mat-error *ngIf="audioForm.get('duration')?.hasError('invalidDuration')">La duración debe ser mayor a 0</mat-error>
                </div>
              </fieldset>

              <!-- Restricción de edad -->
            <label for="age-restriction">Restricción de edad *</label>
              <mat-form-field >
                <mat-label>Restricción de edad</mat-label>
                <input matInput formControlName="ageRestriction" type="number" min="4" max="110" placeholder="Ej: 18" />
                <mat-error *ngIf="audioForm.get('ageRestriction')?.hasError('required')">La restricción de edad es obligatoria</mat-error>
                <mat-error *ngIf="audioForm.get('ageRestriction')?.hasError('min')">Edad mínima 4</mat-error>
                <mat-error *ngIf="audioForm.get('ageRestriction')?.hasError('max')">Edad máxima 110</mat-error>
              </mat-form-field>

              <!-- Disponible hasta -->
            <label for="available-until">Disponible hasta</label>
              <mat-form-field >
                <mat-label>Disponible hasta</mat-label>
                <input matInput [matDatepicker]="picker" formControlName="availableUntil" />
                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-datepicker #picker></mat-datepicker>
              </mat-form-field>

              <!-- VIP --><!-- Estado (Visible) -->
              <div class="toggle-group">
                <mat-slide-toggle formControlName="vip">¿Es contenido VIP?</mat-slide-toggle>
                <mat-slide-toggle formControlName="visible">Visible</mat-slide-toggle>
              </div>

              <!-- Imagen -->
            <div class="form-field">
            <label for="audio">Imagen</label>
            <button 
              type="button" class="photo-selector-btn" 
              (click)="toggleImageOptions()">
              {{ selectedImage ? 'Cambiar imagen' : 'Seleccionar imagen' }}
            </button>
            <div class="photo-options" *ngIf="showImageOptions">
              <div class="photo-grid">
                <img *ngFor="let img of availableImages" 
                    [src]="img.url" 
                    [alt]="img.name"
                    class="photo-option"
                    [class.selected]="selectedImage === img.url"
                    (click)="selectImage(img.url)"
                    (keydown.enter)="selectImage(img.url)">
              </div>
            </div>
          </div>

              <!-- Botones -->
              <div class="button-group">
                <button mat-raised-button color="primary" type="submit"
                  [disabled]="!audioForm.valid || !selectedAudioFile">Guardar
                </button>
                <button mat-raised-button type="button" (click)="resetAudioForm()">Limpiar</button>
              </div>

          </div>
          </form>
        </mat-tab>

        <!-- TAB VÍDEO ------------------------------------------------------------------->
        <mat-tab label="Vídeo">
          <form [formGroup]="videoForm" (ngSubmit)="submitVideoForm()">
            <div class="form-container">
              <!-- Título -->
               <label for="video-title">Título *</label>
              <mat-form-field >
                <mat-label>Título</mat-label>
                <input matInput formControlName="title" maxlength="100" />
                <mat-error *ngIf="videoForm.get('title')?.hasError('required')">El título es obligatorio</mat-error>
                <mat-error *ngIf="videoForm.get('title')?.hasError('maxlength')">Máximo 100 caracteres</mat-error>
                <mat-hint align="end">{{ videoForm.get('title')?.value?.length || 0 }}/100</mat-hint>
              </mat-form-field>

              <!-- Descripción -->
                <label for="video-description">Descripción</label>
              <mat-form-field >
                <mat-label>Descripción</mat-label>
                <textarea matInput formControlName="description" maxlength="500" rows="4"></textarea>
                <mat-error *ngIf="videoForm.get('description')?.hasError('maxlength')">Máximo 500 caracteres</mat-error>
                <mat-hint align="end">{{ videoForm.get('description')?.value?.length || 0 }}/500</mat-hint>
              </mat-form-field>

              <!-- URL de vídeo -->
              <label for="video-url">URL de vídeo *</label>
              <mat-form-field >
                <mat-label>URL de vídeo</mat-label>
                <input matInput formControlName="videoUrl" placeholder="https://ejemplo.com/video.mp4" />
                <mat-error *ngIf="videoForm.get('videoUrl')?.hasError('required')">La URL es obligatoria</mat-error>
                <mat-error *ngIf="videoForm.get('videoUrl')?.hasError('invalidUrl')">Por favor ingresa una URL válida</mat-error>
              </mat-form-field>

              <!-- Tags -->
                <label for="video-tags">Tags *</label>
              <mat-form-field >
                <mat-label>Tags</mat-label>
                <mat-select formControlName="tags" multiple>
                  <mat-option *ngFor="let tag of tags" [value]="tag">{{ tag }}</mat-option>
                </mat-select>
                <mat-error *ngIf="videoForm.get('tags')?.hasError('required')">Selecciona al menos un tag</mat-error>
                <mat-error *ngIf="videoForm.get('tags')?.hasError('minTags')"> Mínimo 1 tag requerido</mat-error>
              </mat-form-field>

              <!-- Duración -->
              <fieldset formGroupName="duration" class="duration-group">
                <legend>Duración *</legend>
                <div class="duration-inputs">
                  <mat-form-field >
                    <mat-label>Horas</mat-label>
                    <input matInput formControlName="hours" type="number" min="0" max="23"/>
                  </mat-form-field>

                  <mat-form-field >
                    <mat-label>Minutos</mat-label>
                    <input matInput formControlName="minutes" type="number" min="0" max="59"/>
                  </mat-form-field>

                  <mat-form-field >
                    <mat-label>Segundos</mat-label>
                    <input matInput formControlName="seconds" type="number" min="0" max="59" />
                  </mat-form-field>
                </div>
                <div class="error-container" *ngIf="videoForm.get('duration')?.invalid && (videoForm.get('duration')?.touched || videoForm.get('duration')?.dirty)">
                  <mat-error *ngIf="videoForm.get('duration')?.hasError('required')">La duración es obligatoria</mat-error>
                  <mat-error *ngIf="videoForm.get('duration')?.hasError('invalidDuration')">La duración debe ser mayor a 0</mat-error>
                </div>
              </fieldset>

              <!-- Resolución -->
              <label for="video-resolution">Resolución *</label>
              <mat-form-field >
                <mat-label>Resolución</mat-label>
                <mat-select formControlName="resolution">
                  <mat-option *ngFor="let res of videoResolutions" [value]="res">{{ res }} </mat-option>
                </mat-select>
              </mat-form-field>

              <!-- Restricción de edad -->
            <label for="age-restriction">Restricción de edad *</label>
              <mat-form-field >
                <mat-label>Restricción de edad</mat-label>
                <input matInput formControlName="ageRestriction" type="number" min="4" max="110" placeholder="Ej: 18" />
                <mat-error *ngIf="videoForm.get('ageRestriction')?.hasError('min')">Valor mínimo 4</mat-error>
                <mat-error *ngIf="videoForm.get('ageRestriction')?.hasError('max')">Valor máximo 110</mat-error>
                <mat-error *ngIf="videoForm.get('ageRestriction')?.hasError('required')">La restricción de edad es obligatoria</mat-error>
              </mat-form-field>

              <!-- Disponible hasta -->
            <label for="video-available-until">Disponible hasta</label>
              <mat-form-field >
                <mat-label>Disponible hasta</mat-label>
                <input matInput [matDatepicker]="pickerVideo" formControlName="availableUntil" />
                <mat-datepicker-toggle matSuffix [for]="pickerVideo"></mat-datepicker-toggle>
                <mat-datepicker #pickerVideo></mat-datepicker>
              </mat-form-field>

              <!-- VIP --><!-- Estado (Visible) -->
              <div class="toggle-group">
                <mat-slide-toggle formControlName="vip">¿Es contenido VIP? *</mat-slide-toggle>
                <mat-slide-toggle formControlName="visible">Visible * </mat-slide-toggle>
              </div>

              <!-- Imagen -->
              <div class="form-field">
            <label for="video-image">Imagen</label>
            <button 
              type="button" class="photo-selector-btn" 
              (click)="toggleImageOptions()">
              {{ selectedImage ? 'Cambiar imagen' : 'Seleccionar imagen' }}
            </button>
            <div class="photo-options" *ngIf="showImageOptions">
              <div class="photo-grid">
                <img *ngFor="let img of availableImages" 
                    [src]="img.url" 
                    [alt]="img.name"
                    class="photo-option"
                    [class.selected]="selectedImage === img.url"
                    (click)="selectImage(img.url)"
                    (keydown.enter)="selectImage(img.url)">
              </div>
            </div>
          </div>
              <!-- Botones -->
              <div class="button-group">
                <button mat-raised-button color="primary" type="submit"
                  [disabled]="!videoForm.valid">Guardar
                </button>
                <button mat-raised-button type="button" (click)="resetVideoForm()">Limpiar</button>
              </div>

            </div>
          </form>
        </mat-tab>
      </mat-tab-group>
    </mat-card-content>
  </mat-card>
</div>
